{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Matias\\\\nexus-pro\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, createContext, useCallback, useMemo } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = 'http://127.0.0.1:8000/api';\nconst decodificarToken = token => {\n  try {\n    return JSON.parse(atob(token.split('.')[1]));\n  } catch (e) {\n    console.error(\"Error al decodificar el token\", e);\n    return null;\n  }\n};\nexport const ContextoAuth = /*#__PURE__*/createContext();\nexport const ProveedorAuth = ({\n  children\n}) => {\n  _s();\n  const [tokensAuth, setTokensAuth] = useState(() => localStorage.getItem('tokensAuth') ? JSON.parse(localStorage.getItem('tokensAuth')) : null);\n  const [usuario, setUsuario] = useState(null);\n  const [cargandoContexto, setCargandoContexto] = useState(true);\n\n  // --- INICIO DE LA CORRECCIÓN FINAL ---\n  const iniciarSesion = async (nombreUsuario, contrasena) => {\n    try {\n      const response = await fetch(`${API_URL}/token/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: nombreUsuario,\n          password: contrasena\n        })\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setTokensAuth(data);\n        setUsuario(decodificarToken(data.access));\n        localStorage.setItem('tokensAuth', JSON.stringify(data));\n        // Devolvemos un objeto indicando éxito\n        return {\n          success: true\n        };\n      } else {\n        // Devolvemos un objeto indicando el fallo y el mensaje\n        return {\n          success: false,\n          message: data.detail || 'Usuario o contraseña incorrectos.'\n        };\n      }\n    } catch (error) {\n      // Devolvemos un objeto indicando el fallo de conexión\n      return {\n        success: false,\n        message: 'Error de conexión con el servidor.'\n      };\n    }\n  };\n  // --- FIN DE LA CORRECCIÓN FINAL ---\n\n  const cerrarSesion = useCallback(() => {\n    setTokensAuth(null);\n    setUsuario(null);\n    localStorage.removeItem('tokensAuth');\n  }, []);\n\n  // El resto del archivo no necesita cambios...\n  const actualizarToken = useCallback(async () => {\n    const tokensActuales = JSON.parse(localStorage.getItem('tokensAuth'));\n    if (!(tokensActuales !== null && tokensActuales !== void 0 && tokensActuales.refresh)) {\n      cerrarSesion();\n      return;\n    }\n    try {\n      const response = await fetch(`${API_URL}/token/refresh/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          'refresh': tokensActuales.refresh\n        })\n      });\n      const data = await response.json();\n      if (response.ok) {\n        const nuevosTokens = {\n          ...tokensActuales,\n          access: data.access\n        };\n        setTokensAuth(nuevosTokens);\n        setUsuario(decodificarToken(data.access));\n        localStorage.setItem('tokensAuth', JSON.stringify(nuevosTokens));\n      } else {\n        cerrarSesion();\n      }\n    } catch {\n      cerrarSesion();\n    }\n  }, [cerrarSesion]);\n  useEffect(() => {\n    if (!tokensAuth) {\n      setCargandoContexto(false);\n      return;\n    }\n    const tokenInfo = decodificarToken(tokensAuth.access);\n    if (!tokenInfo) {\n      cerrarSesion();\n      setCargandoContexto(false);\n      return;\n    }\n    setUsuario(tokenInfo);\n    const ahora = Date.now() / 1000;\n    const tiempoRestante = (tokenInfo.exp - ahora - 60) * 1000;\n    const timeout = setTimeout(() => {\n      actualizarToken();\n    }, tiempoRestante > 0 ? tiempoRestante : 0);\n    setCargandoContexto(false);\n    return () => clearTimeout(timeout);\n  }, [tokensAuth, actualizarToken, cerrarSesion]);\n  const datosContexto = useMemo(() => ({\n    usuario,\n    tokensAuth,\n    iniciarSesion,\n    cerrarSesion\n  }), [usuario, tokensAuth, cerrarSesion, iniciarSesion]);\n  return /*#__PURE__*/_jsxDEV(ContextoAuth.Provider, {\n    value: datosContexto,\n    children: cargandoContexto ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen flex items-center justify-center\",\n      children: \"Cargando...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 33\n    }, this) : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 9\n  }, this);\n};\n_s(ProveedorAuth, \"KPXaRllxV1SGKViXRmO8hYkLjvk=\");\n_c = ProveedorAuth;\nvar _c;\n$RefreshReg$(_c, \"ProveedorAuth\");","map":{"version":3,"names":["React","useState","useEffect","createContext","useCallback","useMemo","jsxDEV","_jsxDEV","API_URL","decodificarToken","token","JSON","parse","atob","split","e","console","error","ContextoAuth","ProveedorAuth","children","_s","tokensAuth","setTokensAuth","localStorage","getItem","usuario","setUsuario","cargandoContexto","setCargandoContexto","iniciarSesion","nombreUsuario","contrasena","response","fetch","method","headers","body","stringify","username","password","data","json","ok","access","setItem","success","message","detail","cerrarSesion","removeItem","actualizarToken","tokensActuales","refresh","nuevosTokens","tokenInfo","ahora","Date","now","tiempoRestante","exp","timeout","setTimeout","clearTimeout","datosContexto","Provider","value","className","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Matias/nexus-pro/src/context/AuthContext.js"],"sourcesContent":["import React, { useState, useEffect, createContext, useCallback, useMemo } from 'react';\r\n\r\nconst API_URL = 'http://127.0.0.1:8000/api';\r\n\r\nconst decodificarToken = (token) => {\r\n    try {\r\n        return JSON.parse(atob(token.split('.')[1]));\r\n    } catch (e) {\r\n        console.error(\"Error al decodificar el token\", e);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport const ContextoAuth = createContext();\r\n\r\nexport const ProveedorAuth = ({ children }) => {\r\n    const [tokensAuth, setTokensAuth] = useState(() => localStorage.getItem('tokensAuth') ? JSON.parse(localStorage.getItem('tokensAuth')) : null);\r\n    const [usuario, setUsuario] = useState(null);\r\n    const [cargandoContexto, setCargandoContexto] = useState(true);\r\n\r\n    // --- INICIO DE LA CORRECCIÓN FINAL ---\r\n    const iniciarSesion = async (nombreUsuario, contrasena) => {\r\n        try {\r\n            const response = await fetch(`${API_URL}/token/`, { \r\n                method: 'POST', \r\n                headers: { 'Content-Type': 'application/json' }, \r\n                body: JSON.stringify({ username: nombreUsuario, password: contrasena }) \r\n            });\r\n            \r\n            const data = await response.json();\r\n\r\n            if (response.ok) { \r\n                setTokensAuth(data); \r\n                setUsuario(decodificarToken(data.access)); \r\n                localStorage.setItem('tokensAuth', JSON.stringify(data));\r\n                // Devolvemos un objeto indicando éxito\r\n                return { success: true };\r\n            } else { \r\n                // Devolvemos un objeto indicando el fallo y el mensaje\r\n                return { success: false, message: data.detail || 'Usuario o contraseña incorrectos.' };\r\n            }\r\n        } catch (error) {\r\n            // Devolvemos un objeto indicando el fallo de conexión\r\n            return { success: false, message: 'Error de conexión con el servidor.' };\r\n        }\r\n    };\r\n    // --- FIN DE LA CORRECCIÓN FINAL ---\r\n\r\n    const cerrarSesion = useCallback(() => { \r\n        setTokensAuth(null); \r\n        setUsuario(null); \r\n        localStorage.removeItem('tokensAuth'); \r\n    }, []);\r\n\r\n    // El resto del archivo no necesita cambios...\r\n    const actualizarToken = useCallback(async () => {\r\n        const tokensActuales = JSON.parse(localStorage.getItem('tokensAuth'));\r\n        if (!tokensActuales?.refresh) {\r\n            cerrarSesion();\r\n            return;\r\n        }\r\n        try {\r\n            const response = await fetch(`${API_URL}/token/refresh/`, { \r\n                method: 'POST', \r\n                headers: { 'Content-Type': 'application/json' }, \r\n                body: JSON.stringify({ 'refresh': tokensActuales.refresh }) \r\n            });\r\n            const data = await response.json();\r\n            if (response.ok) {\r\n                const nuevosTokens = { ...tokensActuales, access: data.access };\r\n                setTokensAuth(nuevosTokens); \r\n                setUsuario(decodificarToken(data.access));\r\n                localStorage.setItem('tokensAuth', JSON.stringify(nuevosTokens));\r\n            } else { \r\n                cerrarSesion(); \r\n            }\r\n        } catch { \r\n            cerrarSesion(); \r\n        }\r\n    }, [cerrarSesion]);\r\n\r\n    useEffect(() => {\r\n        if (!tokensAuth) {\r\n            setCargandoContexto(false);\r\n            return;\r\n        }\r\n        const tokenInfo = decodificarToken(tokensAuth.access);\r\n        if (!tokenInfo) {\r\n            cerrarSesion();\r\n            setCargandoContexto(false);\r\n            return;\r\n        }\r\n        setUsuario(tokenInfo);\r\n        const ahora = Date.now() / 1000;\r\n        const tiempoRestante = (tokenInfo.exp - ahora - 60) * 1000;\r\n        const timeout = setTimeout(() => {\r\n            actualizarToken();\r\n        }, tiempoRestante > 0 ? tiempoRestante : 0);\r\n        setCargandoContexto(false);\r\n        return () => clearTimeout(timeout);\r\n    }, [tokensAuth, actualizarToken, cerrarSesion]);\r\n\r\n    const datosContexto = useMemo(() => ({ \r\n        usuario, \r\n        tokensAuth, \r\n        iniciarSesion, \r\n        cerrarSesion \r\n    }), [usuario, tokensAuth, cerrarSesion, iniciarSesion]);\r\n\r\n    return (\r\n        <ContextoAuth.Provider value={datosContexto}>\r\n            {cargandoContexto ? <div className=\"min-h-screen flex items-center justify-center\">Cargando...</div> : children}\r\n        </ContextoAuth.Provider>\r\n    );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}